<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>API | trilogy</title>
    <meta name="description" content="No-hassle SQLite with a document store style API">
    
    
    <link rel="preload" href="/assets/css/0.styles.cd28fccf.css" as="style"><link rel="preload" href="/assets/js/app.f52a1c03.js" as="script"><link rel="preload" href="/assets/js/2.201cfc91.js" as="script"><link rel="preload" href="/assets/js/11.e5a74d17.js" as="script"><link rel="prefetch" href="/assets/js/10.593d1d76.js"><link rel="prefetch" href="/assets/js/12.b510cb2e.js"><link rel="prefetch" href="/assets/js/13.ad240a66.js"><link rel="prefetch" href="/assets/js/14.7b6a019c.js"><link rel="prefetch" href="/assets/js/15.de714257.js"><link rel="prefetch" href="/assets/js/3.679e5475.js"><link rel="prefetch" href="/assets/js/4.ac0a95b4.js"><link rel="prefetch" href="/assets/js/5.1f05c0b9.js"><link rel="prefetch" href="/assets/js/6.52c79154.js"><link rel="prefetch" href="/assets/js/7.e898385f.js"><link rel="prefetch" href="/assets/js/8.19d8f423.js"><link rel="prefetch" href="/assets/js/9.96ff0ca2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cd28fccf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">trilogy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">learn</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link">Guide</a></li><li class="dropdown-item"><!----> <a href="/reference/api.html" class="nav-link router-link-exact-active router-link-active">API</a></li><li class="dropdown-item"><!----> <a href="/reference/backends.html" class="nav-link">Backends</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">contribute</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/citycide/trilogy/issues" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issues
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/citycide/trilogy/pulls" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Pull Requests
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/citycide/trilogy/blob/next/.github/contributing.md#contributor-guide" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Contributor Guide
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://github.com/citycide/trilogy/blob/next/.github/code_of_conduct.md#contributor-covenant-code-of-conduct" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Code of Conduct
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">about</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/changelog.html" class="nav-link">Changelog</a></li><li class="dropdown-item"><!----> <a href="/about/license.html" class="nav-link">License</a></li></ul></div></div> <a href="https://github.com/citycide/trilogy" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">learn</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link">Guide</a></li><li class="dropdown-item"><!----> <a href="/reference/api.html" class="nav-link router-link-exact-active router-link-active">API</a></li><li class="dropdown-item"><!----> <a href="/reference/backends.html" class="nav-link">Backends</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">contribute</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/citycide/trilogy/issues" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issues
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/citycide/trilogy/pulls" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Pull Requests
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/citycide/trilogy/blob/next/.github/contributing.md#contributor-guide" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Contributor Guide
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://github.com/citycide/trilogy/blob/next/.github/code_of_conduct.md#contributor-covenant-code-of-conduct" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Code of Conduct
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">about</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/changelog.html" class="nav-link">Changelog</a></li><li class="dropdown-item"><!----> <a href="/about/license.html" class="nav-link">License</a></li></ul></div></div> <a href="https://github.com/citycide/trilogy" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>API</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reference/api.html#connect" class="sidebar-link">connect</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/reference/api.html#trilogy-class" class="sidebar-link">Trilogy (Class)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reference/api.html#model" class="sidebar-link">model</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#getmodel" class="sidebar-link">getModel</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#hasmodel" class="sidebar-link">hasModel</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#dropmodel" class="sidebar-link">dropModel</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#raw" class="sidebar-link">raw</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#close" class="sidebar-link">close</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#models" class="sidebar-link">models</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#knex" class="sidebar-link">knex</a></li></ul></li><li><a href="/reference/api.html#model-class" class="sidebar-link">Model (Class)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reference/api.html#create" class="sidebar-link">create</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#find" class="sidebar-link">find</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#findin" class="sidebar-link">findIn</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#findone" class="sidebar-link">findOne</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#findonein" class="sidebar-link">findOneIn</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#findorcreate" class="sidebar-link">findOrCreate</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#update" class="sidebar-link">update</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#updateorcreate" class="sidebar-link">updateOrCreate</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#get" class="sidebar-link">get</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#set" class="sidebar-link">set</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#getraw" class="sidebar-link">getRaw</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#setraw" class="sidebar-link">setRaw</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#increment" class="sidebar-link">increment</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#decrement" class="sidebar-link">decrement</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#remove" class="sidebar-link">remove</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#clear" class="sidebar-link">clear</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#count" class="sidebar-link">count</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#countin" class="sidebar-link">countIn</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#min" class="sidebar-link">min</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#max" class="sidebar-link">max</a></li></ul></li><li><a href="/reference/api.html#hooks" class="sidebar-link">Hooks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reference/api.html#onquery-hook" class="sidebar-link">onQuery Hook</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#beforecreate-hook" class="sidebar-link">beforeCreate Hook</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#aftercreate-hook" class="sidebar-link">afterCreate Hook</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#beforeupdate-hook" class="sidebar-link">beforeUpdate Hook</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#afterupdate-hook" class="sidebar-link">afterUpdate Hook</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#beforeremove-hook" class="sidebar-link">beforeRemove Hook</a></li><li class="sidebar-sub-header"><a href="/reference/api.html#afterremove-hook" class="sidebar-link">afterRemove Hook</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="connect"><a href="#connect" aria-hidden="true" class="header-anchor">#</a> connect</h2> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">connect</span> <span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">:</span> TrilogyOptions<span class="token punctuation">)</span><span class="token punctuation">:</span> Trilogy
</code></pre></div><p>Initialize a new datastore instance, creating a SQLite database file at
the provided <code>path</code> if it does not yet exist, or reading it if it does.</p> <p>trilogy can use both the native <code>sqlite3</code> module or <code>sql.js</code> — the
latter does not require compiling, whereas the former must be built against
its runtime environment. The goal is that the difference should be totally
invisible to you, so usage from trilogy's standpoint stays the same no
matter which one you choose. You should also be able to change it at any
time without any hitches.</p> <p>If <code>path</code> is exactly <code>':memory:'</code>, no file will be created and an in-memory
store will be used. This doesn't persist any of the data.</p> <p>See <a href="/reference/backends.html"><em>&quot;Backends&quot;</em></a> for more about the backend options trilogy
supports and some guidance on which to choose.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} path</code>:
absolute or relative file path. If relative it is resolved against
<code>process.cwd()</code>, or the <code>options.dir</code> property if it is provided.</li> <li><em>optional</em> <code>{TrilogyOptions} options</code>:</li></ul> <table><thead><tr><th>property</th> <th style="text-align:center;">type</th> <th style="text-align:center;">default</th> <th>description</th></tr></thead> <tbody><tr><td><code>client</code></td> <td style="text-align:center;"><code>string</code></td> <td style="text-align:center;"><code>sqlite3</code></td> <td>Must be one of <code>sqlite3</code> or <code>sql.js</code>.</td></tr> <tr><td><code>dir</code></td> <td style="text-align:center;"><code>string</code></td> <td style="text-align:center;"><code>process.cwd()</code></td> <td>The working directory with which to resolve <code>path</code>.</td></tr> <tr><td><code>verbose</code></td> <td style="text-align:center;"><code>Function</code></td> <td style="text-align:center;"><code>() =&gt; {}</code></td> <td>Receives every query run against the database.</td></tr></tbody></table></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><a href="#trilogy-class"><code>Trilogy</code></a></p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'trilogy'</span>

<span class="token comment">// defaults to using `sqlite3`</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'./storage.db'</span><span class="token punctuation">)</span>
</code></pre></div><p>With an options object:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'./storage.db'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// use `sql.js` to avoid build issues with gyp</span>
  client<span class="token punctuation">:</span> <span class="token string">'sql.js'</span><span class="token punctuation">,</span>

  <span class="token comment">// directory with which to resolve `path`</span>
  <span class="token comment">// it defaults to `process.cwd()`</span>
  dir<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./here'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">// pass a function that receives all queries run</span>
  verbose<span class="token punctuation">:</span> <span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <div class="throws custom-block"><p class="custom-block-title">THROWS</p> <p>if <code>path</code> is not provided</p></div> <h2 id="trilogy-class"><a href="#trilogy-class" aria-hidden="true" class="header-anchor">#</a> Trilogy (<code>Class</code>)</h2> <h3 id="model"><a href="#model" aria-hidden="true" class="header-anchor">#</a> model</h3> <div class="language-ts extra-class"><pre class="language-ts"><code>model <span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> schema<span class="token punctuation">:</span> SchemaRaw<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">:</span> ModelOptions<span class="token punctuation">)</span><span class="token punctuation">:</span>
  Promise<span class="token operator">&lt;</span>Model<span class="token operator">&gt;</span>
</code></pre></div><div class="tip custom-block"><p>If you're using TypeScript, you should provide your own type as the
generic <code>D</code>, which will allow for much more powerful typechecking! If
you're using JavaScript you can safely ignore the additional <code>&lt;D&gt;</code>
syntax and think of <code>D</code> as being any old <code>object</code>.</p></div> <p>Define a new model with the provided <code>schema</code>, or return the existing model
if one is already defined with <code>name</code>.</p> <p>Each property of <code>schema</code> describes a column, where its key is the name of
the column and its value describes its attributes. The value can be either
a type, such as <code>String</code>, <code>Number</code>, or <code>'increments'</code>, or a more descriptive
object. See <a href="/guide/defining-models.html#property-descriptors"><em>&quot;Property descriptors&quot;</em></a>
for more information.</p> <p>This schema controls the handling of values inserted into and retreived from
the database, casting them as needed. For example, SQLite does not support a
boolean data type and instead stores them as integers. trilogy will
transparently cast booleans to integers when inserting them and back to
booleans when retreiving them. The same goes for all other
<a href="/guide/defining-models.html#property-types">supported data types</a>. Unknown
column types will cause an error to be thrown.</p> <p>If any property of <code>schema</code> is not present in knex's methods it will be
ignored. See <a href="http://knexjs.org/#Schema-Building" target="_blank" rel="noopener noreferrer">knex's documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
on Schema Building for the available attributes when defining properties.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} name</code>: name of the model</li> <li><code>{SchemaRaw} schema</code>: describes the schema of the table</li> <li><em>optional</em> <code>{ModelOptions} options</code>:</li></ul> <table><thead><tr><th>property</th> <th style="text-align:center;">type</th> <th style="text-align:center;">default</th> <th>description</th></tr></thead> <tbody><tr><td><code>timestamps</code></td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;">-</td> <td>When <code>true</code>, adds <code>created_at</code> and <code>updated_at</code> properties, both defaulting to the current timestamp.</td></tr> <tr><td><code>primary</code></td> <td style="text-align:center;"><code>string[]</code></td> <td style="text-align:center;">-</td> <td>An array of column names to specify as a composite primary key.</td></tr> <tr><td><code>unique</code></td> <td style="text-align:center;"><code>string[]</code></td> <td style="text-align:center;">-</td> <td>An array of column names on which to apply unique constraints.</td></tr> <tr><td><code>index</code></td> <td style="text-align:center;"><code>string</code>, <code>string[]</code>, <code>Array&lt;string[]&gt;</code>, <code>object</code></td> <td style="text-align:center;">-</td> <td>See <a href="/guide/defining-models.html#complex-indexing"><em>&quot;Complex indexing&quot;</em></a></td></tr></tbody></table></div> <div class="warning custom-block"><p>Specifying a column as either <code>primary</code> or <code>unique</code> in both the column
descriptor and the <code>options.primary</code> or <code>options.unique</code> arrays will result
in an error, as the constraint will have already been applied.</p></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;</code><a href="#model-class"><code>Model</code></a><code>&lt;D&gt;&gt;</code></p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
  email<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  uid<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> Number<span class="token punctuation">,</span> primary<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token string">'people.age'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// already defined, so it's returned</span>
<span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">)</span>

<span class="token comment">// since `model()` returns a model instance,</span>
<span class="token comment">// you can use methods on that instance like so:</span>
<span class="token keyword">await</span> people<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">await</span> people<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">await</span> people<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="getmodel"><a href="#getmodel" aria-hidden="true" class="header-anchor">#</a> getModel</h3> <div class="language-ts extra-class"><pre class="language-ts"><code>getModel <span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Model
</code></pre></div><p>Provides a way to synchronously retrieve a model. If that model doesn't
exist an error will be thrown, so you should only use this if you're sure
it has been defined. Or you can check first with <a href="#hasmodel"><code>hasModel</code></a>
or use <a href="#model"><code>model</code></a>, which returns existing definitions.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} name</code>: name of the model</li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><a href="#model-class"><code>Model</code></a></p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">)</span>
<span class="token comment">// Error: no model defined by the name 'people'</span>

<span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> alsoPeople <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">)</span>
alsoPeople<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span>

<span class="token comment">// these reference the exact same object (the `Model`)</span>
people <span class="token operator">===</span> alsoPeople
<span class="token comment">// -&gt; true</span>
</code></pre></div></div> <div class="throws custom-block"><p class="custom-block-title">THROWS</p> <p>if no model by the name of <code>name</code> has been created</p></div> <h3 id="hasmodel"><a href="#hasmodel" aria-hidden="true" class="header-anchor">#</a> hasModel</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">hasModel</span> <span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span>
</code></pre></div><p>First checks if the model's been defined with trilogy, then runs an existence
query on the database, returning <code>true</code> if the table exists or <code>false</code> if it
doesn't.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} name</code>: the name of the model to check</li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;boolean&gt;</code></p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> exists <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">hasModel</span><span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>exists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'it exists!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <h3 id="dropmodel"><a href="#dropmodel" aria-hidden="true" class="header-anchor">#</a> dropModel</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">dropModel</span> <span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span>
</code></pre></div><p>Removes the specified model from trilogy's definition and the database.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} name</code>: the name of the model to remove</li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;boolean&gt;</code>: <code>true</code> if successful or <code>false</code> if the model was not
defined with trilogy</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">dropModel</span><span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">)</span>
<span class="token comment">// model &amp; table dropped</span>
</code></pre></div></div> <h3 id="raw"><a href="#raw" aria-hidden="true" class="header-anchor">#</a> raw</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">raw</span> <span class="token punctuation">(</span>query<span class="token punctuation">:</span> knex<span class="token punctuation">.</span>QueryBuilder <span class="token operator">|</span> knex<span class="token punctuation">.</span>Raw<span class="token punctuation">,</span> needResponse<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span>
</code></pre></div><p>Allows running any arbitrary query generated by trilogy's <a href="#knex"><code>.knex</code></a>
instance. If the result is needed, pass <code>true</code> as the second argument, otherwise
the number of affected rows will be returned ( if applicable ).</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{knex.QueryBuilder | knex.Raw} query</code>: any knex query created with <a href="#knex"><code>.knex</code></a></li> <li><code>{boolean} needResponse</code>: whether to return the result of the query</li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;any&gt;</code></p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> query <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">knex</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">innerJoin</span><span class="token punctuation">(</span><span class="token string">'accounts'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'accounts.id'</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token string">'users.account_id'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">orOn</span><span class="token punctuation">(</span><span class="token string">'accounts.owner_id'</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token string">'users.id'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">raw</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="close"><a href="#close" aria-hidden="true" class="header-anchor">#</a> close</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">close</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span>
</code></pre></div><p>Drains the connection pools and releases connections to any open database
files. This should always be called at the end of your program to gracefully
shut down, and only once since the connection can't be reopened.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <p>None</p></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;void&gt;</code></p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'trilogy'</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'./file.db'</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'release'</span><span class="token punctuation">,</span> <span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">2001</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>titles <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> titles<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>title <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">doSomething</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// sometime later ... program ending ...</span>
db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// database connection ended</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="models"><a href="#models" aria-hidden="true" class="header-anchor">#</a> models</h3> <div class="language-ts extra-class"><pre class="language-ts"><code>models<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre></div><p>An array of all model names defined on the instance.</p> <h3 id="knex"><a href="#knex" aria-hidden="true" class="header-anchor">#</a> knex</h3> <p>Exposes trilogy's knex instance to allow more complex query building.
You can use this to create queries that aren't necessarily feasible
with trilogy's API, like nested where clauses that require functions
as arguments.</p> <div class="danger custom-block"><p>It is highly recommended that you do <em>not</em> call <code>then</code> or otherwise execute
the query. Pass the knex query object as-is to <a href="#raw"><code>raw()</code></a> for execution.
This ensures maximum compatibility between backends.</p> <p>All of the following methods will cause execution when chained to a
knex query, so avoid using these when building raw queries you intend
to run with trilogy:</p> <ul><li>Promises: <code>then</code>, <code>catch</code>, <code>tap</code>, <code>map</code>, <code>reduce</code>, <code>bind</code>, <code>return</code></li> <li>Callbacks: <code>asCallback</code></li> <li>Streams: <code>stream</code>, <code>pipe</code></li></ul></div> <p>The following methods shouldn't cause problems, but they aren't
guaranteed to work, especially when using <code>sql.js</code>:</p> <ul><li>Events: <code>on</code> [<code>'query'</code>, <code>'query-error'</code>, <code>'query-response'</code>]</li></ul> <p>And finally the following methods will work just fine, but you should
not chain them on a query object before passing it to trilogy. Running
them separately is fine:</p> <ul><li>Other: <code>toString</code>, <code>toSQL</code></li></ul> <p>For more advanced usage, see <a href="http://knexjs.org/" target="_blank" rel="noopener noreferrer">knex's own documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'trilogy'</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'./file.db'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> query <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">knex</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 'select * from `users`'</span>

db<span class="token punctuation">.</span><span class="token function">raw</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>users <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <p>More complex queries are possible this way:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> query <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">knex</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">innerJoin</span><span class="token punctuation">(</span><span class="token string">'accounts'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'accounts.id'</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token string">'users.account_id'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">orOn</span><span class="token punctuation">(</span><span class="token string">'accounts.owner_id'</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token string">'users.id'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">raw</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><em>Don't</em> do the following, as it will cause query execution.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">knex</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="model-class"><a href="#model-class" aria-hidden="true" class="header-anchor">#</a> Model (<code>Class</code>)</h2> <p>Model instances are created using <a href="#model"><code>model()</code></a>. Almost every model
instance method is also accessible at the top level of a trilogy instance,
meaning the following calls are equivalent:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// given this setup:</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'./storage.db'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">/* some schema */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// these are equivalent:</span>
<span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'citycide'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">await</span> users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'citycide'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">EXCEPTIONS</p> <p>These model instance methods don't exist on database instances:</p> <ul><li><a href="#findin">findIn</a> — use <code>find</code> with <code>'table.column'</code> dot-notation</li> <li><a href="#findonein">findOneIn</a> — use <code>findOne</code> with <code>'table.column'</code> dot-notation</li> <li><a href="#countin">countIn</a> — use <code>count</code> with <code>'table.column'</code> dot-notation</li></ul></div> <p>The function signatures remain the same except you provide the model name and,
in some cases, the column name, as the first argument. Column names should be
passed along with the table in dot-notation, ie. <code>'users.name'</code>.</p> <p>If you're using TypeScript, you should provide a type to the model constructor
to make typechecking much more powerful:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">':memory:'</span><span class="token punctuation">)</span>

<span class="token keyword">type</span> Game <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  players<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  is_card<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span>
  is_dice<span class="token punctuation">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">}</span>

<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// provide the `Game` type to `model()` here</span>
  <span class="token keyword">const</span> games <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>model<span class="token operator">&lt;</span>Game<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">'games'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    players<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
    is_card<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
    is_dice<span class="token punctuation">:</span> Boolean
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// this could fail at compile time if it didn't satisfy the provided type</span>
  <span class="token keyword">await</span> games<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'Solitaire'</span><span class="token punctuation">,</span>
    players<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    is_card<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    is_dice<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// type is inferred here as `Game[]`</span>
  <span class="token keyword">const</span> allGames <span class="token operator">=</span> <span class="token keyword">await</span> games<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// you get suggestions and type checking here</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>allGames<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>players<span class="token punctuation">)</span>
  <span class="token comment">// -&gt; 1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>If you don't provide a type, a loose default is used that prevents strong
type safety.</p> <div class="tip custom-block"><p>For TypeScript users, <code>Model</code> classes can be constructed with a generic type
that determines how their methods are typechecked. That type is represented as
a <code>D</code> in this documentation.</p></div> <h3 id="create"><a href="#create" aria-hidden="true" class="header-anchor">#</a> create</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">create</span> <span class="token punctuation">(</span>object<span class="token punctuation">:</span> <span class="token constant">D</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">:</span> CreateOptions<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span>
</code></pre></div><p>Insert an object into the table. <code>object</code> should match the model's defined
schema, values will cast into types as needed. If a unique or primary
constraint exists on a property the insert will be ignored when violating
this constraint.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{D} object</code>: the data to insert</li> <li><em>optional</em> <code>{CreateOptions} options</code></li></ul> <table><thead><tr><th>property</th> <th style="text-align:center;">type</th> <th style="text-align:center;">default</th> <th>description</th></tr></thead> <tbody><tr><td><code>raw</code></td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;"><code>false</code></td> <td>If <code>true</code>, will bypass getters &amp; setters.</td></tr></tbody></table></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;D&gt;</code>: the created object</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code>players<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token number">197397332</span><span class="token punctuation">,</span>
  username<span class="token punctuation">:</span> <span class="token string">'xX420_sniperXx'</span><span class="token punctuation">,</span>
  friends<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'xX420_kniferXx'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>object <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span>
  <span class="token comment">// -&gt; { id: 197397332,</span>
  <span class="token comment">//      username: 'xX420_sniperXx',</span>
  <span class="token comment">//      friends: ['xX420_kniferXx'] }</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="find"><a href="#find" aria-hidden="true" class="header-anchor">#</a> find</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">find</span> <span class="token punctuation">(</span>criteria<span class="token operator">?</span><span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">:</span> FindOptions<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre></div><p>Find all objects matching <code>criteria</code>.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><em>optional</em> <code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li> <li><em>optional</em> <code>{FindOptions} options</code>:</li></ul> <table><thead><tr><th>property</th> <th style="text-align:center;">type</th> <th style="text-align:center;">default</th> <th>description</th></tr></thead> <tbody><tr><td><code>random</code></td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;"><code>false</code></td> <td>Select a single random record.</td></tr> <tr><td><code>order</code></td> <td style="text-align:center;"><code>string</code>, <code>[string, string]</code></td> <td style="text-align:center;">-</td> <td>Specify a selection order. See <a href="http://knexjs.org/#Builder-orderBy" target="_blank" rel="noopener noreferrer">the knex docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</td></tr> <tr><td><code>limit</code></td> <td style="text-align:center;"><code>number</code></td> <td style="text-align:center;">-</td> <td>Limit the rows returned.</td></tr> <tr><td><code>skip</code></td> <td style="text-align:center;"><code>number</code></td> <td style="text-align:center;">-</td> <td>Skip (offset) a number of records.</td></tr> <tr><td><code>raw</code></td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;"><code>false</code></td> <td>If <code>true</code>, will bypass getters &amp; setters.</td></tr></tbody></table> <p><em>Note: if <code>options.random</code> is provided, <code>options.order</code> is ignored.</em></p></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;D[]&gt;</code>: array of found objects</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  body<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  priority<span class="token punctuation">:</span> Number
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'code'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'create the best thing'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'docs'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'crap what did I create'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'tests'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'totally works'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> found <span class="token operator">=</span> <span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'priority'</span><span class="token punctuation">,</span> <span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>found<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>todo <span class="token operator">=&gt;</span> todo<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; ['code', 'docs']</span>
</code></pre></div></div> <h3 id="findin"><a href="#findin" aria-hidden="true" class="header-anchor">#</a> findIn</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">findIn</span> <span class="token punctuation">(</span>
  column<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> criteria<span class="token operator">?</span><span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">:</span> FindOptions
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token constant">D</span><span class="token punctuation">[</span>keyof <span class="token constant">D</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre></div><p>Find all objects matching <code>criteria</code> and extract the given column from each one.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} column</code>: the column to select from matching objects</li> <li><em>optional</em> <code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li> <li><em>optional</em> <code>{FindOptions} options</code>:</li></ul> <table><thead><tr><th>property</th> <th style="text-align:center;">type</th> <th style="text-align:center;">default</th> <th>description</th></tr></thead> <tbody><tr><td><code>random</code></td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;"><code>false</code></td> <td>Select a single random record.</td></tr> <tr><td><code>order</code></td> <td style="text-align:center;"><code>string</code>, <code>[string, string]</code></td> <td style="text-align:center;">-</td> <td>Specify a selection order. See <a href="http://knexjs.org/#Builder-orderBy" target="_blank" rel="noopener noreferrer">the knex docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</td></tr> <tr><td><code>limit</code></td> <td style="text-align:center;"><code>number</code></td> <td style="text-align:center;">-</td> <td>Limit the rows returned.</td></tr> <tr><td><code>skip</code></td> <td style="text-align:center;"><code>number</code></td> <td style="text-align:center;">-</td> <td>Skip (offset) a number of records.</td></tr> <tr><td><code>raw</code></td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;"><code>false</code></td> <td>If <code>true</code>, will bypass getters &amp; setters.</td></tr></tbody></table> <p><em>Note: if <code>options.random</code> is provided, <code>options.order</code> is ignored.</em></p></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;(D[keyof D])[]&gt;</code>: value at <code>column</code> from each matching object</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  body<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  priority<span class="token punctuation">:</span> Number
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'code'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'create the best thing'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'docs'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'crap what did I create'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'tests'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'totally works'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> found <span class="token operator">=</span> <span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token function">findIn</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'priority'</span><span class="token punctuation">,</span> <span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span>
<span class="token comment">// -&gt; ['code', 'docs']</span>
</code></pre></div></div> <h3 id="findone"><a href="#findone" aria-hidden="true" class="header-anchor">#</a> findOne</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">findOne</span> <span class="token punctuation">(</span>criteria<span class="token operator">?</span><span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">:</span> FindOptions<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span>
</code></pre></div><p>Find a single object.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><em>optional</em> <code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li> <li><em>optional</em> <code>{FindOptions} options</code>:</li></ul> <table><thead><tr><th>property</th> <th style="text-align:center;">type</th> <th style="text-align:center;">default</th> <th>description</th></tr></thead> <tbody><tr><td><code>random</code></td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;"><code>false</code></td> <td>Select a single random record.</td></tr> <tr><td><code>order</code></td> <td style="text-align:center;"><code>string</code>, <code>[string, string]</code></td> <td style="text-align:center;">-</td> <td>Specify a selection order. See <a href="http://knexjs.org/#Builder-orderBy" target="_blank" rel="noopener noreferrer">the knex docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</td></tr> <tr><td><code>skip</code></td> <td style="text-align:center;"><code>number</code></td> <td style="text-align:center;">-</td> <td>Skip (offset) a number of records.</td></tr> <tr><td><code>raw</code></td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;"><code>false</code></td> <td>If <code>true</code>, will bypass getters &amp; setters.</td></tr></tbody></table> <p><em>Note: if <code>options.random</code> is provided, <code>options.order</code> is ignored.</em></p></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;D&gt;</code>: the found object</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  body<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  priority<span class="token punctuation">:</span> Number
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'code'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'create the best thing'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'docs'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'crap what did I create'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'tests'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'totally works'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> found <span class="token operator">=</span> <span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'docs'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>found<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
<span class="token comment">// -&gt; 'crap what did I create'</span>
</code></pre></div></div> <h3 id="findonein"><a href="#findonein" aria-hidden="true" class="header-anchor">#</a> findOneIn</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">findOneIn</span> <span class="token punctuation">(</span>
  column<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> criteria<span class="token operator">?</span><span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">:</span> FindOptions
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token punctuation">[</span>keyof <span class="token constant">D</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre></div><p>Find a single object.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} column</code>: the column to select from the matching object</li> <li><em>optional</em> <code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li> <li><em>optional</em> <code>{FindOptions} options</code>:</li></ul> <table><thead><tr><th>property</th> <th style="text-align:center;">type</th> <th style="text-align:center;">default</th> <th>description</th></tr></thead> <tbody><tr><td><code>random</code></td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;"><code>false</code></td> <td>Select a single random record.</td></tr> <tr><td><code>order</code></td> <td style="text-align:center;"><code>string</code>, <code>[string, string]</code></td> <td style="text-align:center;">-</td> <td>Specify a selection order. See <a href="http://knexjs.org/#Builder-orderBy" target="_blank" rel="noopener noreferrer">the knex docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</td></tr> <tr><td><code>skip</code></td> <td style="text-align:center;"><code>number</code></td> <td style="text-align:center;">-</td> <td>Skip (offset) a number of records.</td></tr> <tr><td><code>raw</code></td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;"><code>false</code></td> <td>If <code>true</code>, will bypass getters &amp; setters.</td></tr></tbody></table> <p><em>Note: if <code>options.random</code> is provided, <code>options.order</code> is ignored.</em></p></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;D[keyof D]&gt;</code>: value at <code>column</code> of the found object</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  body<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  priority<span class="token punctuation">:</span> Number
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'code'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'create the best thing'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'docs'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'crap what did I create'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'tests'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'totally works'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> found <span class="token operator">=</span> <span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token function">findOneIn</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> priority<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span>
<span class="token comment">// -&gt; { name: 'code',</span>
<span class="token comment">//      body: 'create the best thing',</span>
<span class="token comment">//      priority: 1 }</span>
</code></pre></div></div> <h3 id="findorcreate"><a href="#findorcreate" aria-hidden="true" class="header-anchor">#</a> findOrCreate</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">findOrCreate</span> <span class="token punctuation">(</span>
  criteria<span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> creation<span class="token punctuation">:</span> Partial<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">:</span> FindOptions
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span>
</code></pre></div><p>Find a matching object based on <code>criteria</code>, or create it if it doesn't exist.
When creating the object, a merged object created from <code>criteria</code> and <code>creation</code>
will be used, with the properties from <code>creation</code> taking precedence.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{Criteria&lt;D&gt;} criteria</code>: criteria to search for</li> <li><code>{Partial&lt;D&gt;} creation</code>: data used to create the object if it doesn't exist</li> <li><em>optional</em> <code>{FindOptions} options</code>: same as <a href="#findOne"><code>findOne()</code></a></li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;D&gt;</code>: the found object, after creation if necessary</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span> primary<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
  adult<span class="token punctuation">:</span> Boolean
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token keyword">await</span> people<span class="token punctuation">.</span><span class="token function">findOrCreate</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Joe'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> age<span class="token punctuation">:</span> <span class="token number">13</span><span class="token punctuation">,</span> adult<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
<span class="token comment">// -&gt; { name: 'Joe', age: 13, adult: false }</span>

<span class="token keyword">const</span> person2 <span class="token operator">=</span> <span class="token keyword">await</span> people<span class="token punctuation">.</span><span class="token function">findOrCreate</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Joe'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> age<span class="token punctuation">:</span> <span class="token number">99</span><span class="token punctuation">,</span> adult<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// 'Joe' already exists and is returned</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span>
<span class="token comment">// -&gt; { name: 'Joe', age: 13, adult: false }</span>
</code></pre></div></div> <h3 id="update"><a href="#update" aria-hidden="true" class="header-anchor">#</a> update</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">update</span> <span class="token punctuation">(</span>
  criteria<span class="token operator">?</span><span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token punctuation">:</span> Partial<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">:</span> UpdateOptions
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span>
</code></pre></div><p>Modify the properties of an existing object. While optional, if <code>data</code> contains
no properties no update queries will be run.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><em>optional</em> <code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li> <li><em>optional</em> <code>{Partial&lt;D&gt;} data</code>: the updates to be made</li> <li><em>optional</em> <code>{UpdateOptions} options</code></li></ul> <table><thead><tr><th>property</th> <th style="text-align:center;">type</th> <th style="text-align:center;">default</th> <th>description</th></tr></thead> <tbody><tr><td><code>raw</code></td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;"><code>false</code></td> <td>If <code>true</code>, will bypass getters &amp; setters.</td></tr></tbody></table></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;number&gt;</code>: the number of rows affected</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> games <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'games'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span> primary<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  genre<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  owned<span class="token punctuation">:</span> Boolean
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> games<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Overwatch'</span><span class="token punctuation">,</span> genre<span class="token punctuation">:</span> <span class="token string">'FPS'</span><span class="token punctuation">,</span> owned<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> rowsAffected <span class="token operator">=</span> <span class="token keyword">await</span> games<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Overwatch'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> owned<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rowsAffected<span class="token punctuation">)</span>
<span class="token comment">// -&gt; 1</span>
</code></pre></div></div> <h3 id="updateorcreate"><a href="#updateorcreate" aria-hidden="true" class="header-anchor">#</a> updateOrCreate</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">updateOrCreate</span> <span class="token punctuation">(</span>
  criteria<span class="token punctuation">:</span> CriteriaObj<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> Partial<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  options<span class="token operator">?</span><span class="token punctuation">:</span> UpdateOptions <span class="token operator">&amp;</span> CreateOptions
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span>
</code></pre></div><p>Update an existing object or create it if it doesn't exist. If creation
is necessary a merged object created from <code>criteria</code> and <code>data</code> will be
used, with the properties from <code>data</code> taking precedence.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{CriteriaObj&lt;D&gt;} criteria</code>: criteria to search for</li> <li><code>{Partial&lt;D&gt;} data</code>: updates to be made, or used for object creation</li> <li><em>optional</em> <code>{UpdateOptions &amp; CreateOptions} options</code>: same as <a href="#update"><code>update()</code></a></li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;number&gt;</code>: the number of rows affected</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> games <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'games'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span> primary<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  genre<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  owned<span class="token punctuation">:</span> Boolean
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> rowsUpdated <span class="token operator">=</span> <span class="token keyword">await</span> games<span class="token punctuation">.</span><span class="token function">updateOrCreate</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Ms. PacMan'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> owned<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> genre<span class="token punctuation">:</span> <span class="token string">'arcade'</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token comment">// -&gt; 1</span>

<span class="token keyword">await</span> games<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Ms. PacMan'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; { name: 'Ms. PacMan', owned: false, genre: 'arcade' }</span>
</code></pre></div></div> <h3 id="get"><a href="#get" aria-hidden="true" class="header-anchor">#</a> get</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">get</span> <span class="token punctuation">(</span>
  column<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> criteria<span class="token operator">?</span><span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> defaultValue<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">D</span><span class="token punctuation">[</span>keyof <span class="token constant">D</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token punctuation">[</span>keyof <span class="token constant">D</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre></div><p>Works similarly to the <code>get</code> methods in lodash, underscore, etc. Returns
the value at <code>column</code> or, if it does not exist, the supplied <code>defaultValue</code>.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} column</code>: the property to retrieve</li> <li><em>optional</em> <code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li> <li><em>optional</em> <code>{D[keyof D]} defaultValue</code>: returned if the result doesn't exist</li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;D[keyof D]&gt;</code></p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  body<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  priority<span class="token punctuation">:</span> Number
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'code'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'create the best thing'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'docs'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'crap what did I create'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'tests'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'totally works'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'priority'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'code'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 1</span>

<span class="token comment">// with default value</span>
<span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'priority'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'eat'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">999</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 999</span>
</code></pre></div></div> <h3 id="set"><a href="#set" aria-hidden="true" class="header-anchor">#</a> set</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">set</span> <span class="token punctuation">(</span>
  column<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> criteria<span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token constant">D</span><span class="token punctuation">[</span>keyof <span class="token constant">D</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span>
</code></pre></div><p>Works similarly to the <code>set</code> methods in lodash, underscore, etc. Updates
the value at <code>column</code> to be <code>value</code> where <code>criteria</code> is met.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} column</code>: the column to update</li> <li><code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li> <li><code>{D[keyof D]} value</code>: the new value</li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;number&gt;</code>: the number of rows affected</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  body<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  priority<span class="token punctuation">:</span> Number
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'code'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'create the best thing'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'docs'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'crap what did I create'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'tests'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'totally works'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'priority'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'docs'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 1</span>

<span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'priority'</span><span class="token punctuation">,</span> <span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'not important ;)'</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 2</span>
</code></pre></div></div> <h3 id="getraw"><a href="#getraw" aria-hidden="true" class="header-anchor">#</a> getRaw</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">getRaw</span> <span class="token punctuation">(</span>
  column<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> criteria<span class="token operator">?</span><span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> defaultValue<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">D</span><span class="token punctuation">[</span>keyof <span class="token constant">D</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token punctuation">[</span>keyof <span class="token constant">D</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre></div><p>Works exactly like <a href="#get"><code>get()</code></a> but bypasses getters and retrieves
the raw database value.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} column</code>: the property to retrieve</li> <li><em>optional</em> <code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li> <li><em>optional</em> <code>{D[keyof D]} defaultValue</code>: returned if the result doesn't exist</li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;D[keyof D]&gt;</code></p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  body<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  priority<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
    <span class="token keyword">get</span><span class="token punctuation">:</span> priority <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'wrecked'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'code'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'create the best thing'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'docs'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'crap what did I create'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'tests'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'totally works'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token function">getRaw</span><span class="token punctuation">(</span><span class="token string">'priority'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'code'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 1</span>

<span class="token comment">// with default value</span>
<span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token function">getRaw</span><span class="token punctuation">(</span><span class="token string">'priority'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'eat'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">999</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 999</span>

<span class="token comment">// using the non-raw method fires the getter</span>
<span class="token comment">// this causes the error above to be thrown</span>

<span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'priority'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'code'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; Error: 'wrecked'</span>
</code></pre></div></div> <h3 id="setraw"><a href="#setraw" aria-hidden="true" class="header-anchor">#</a> setRaw</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">setRaw</span> <span class="token punctuation">(</span>
  column<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> criteria<span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token constant">D</span><span class="token punctuation">[</span>keyof <span class="token constant">D</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span>
</code></pre></div><p>Works exactly like <a href="#set"><code>set()</code></a> but bypasses setters when
updating the target value.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} column</code>: the column to update</li> <li><code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li> <li><code>{D[keyof D]} value</code>: the new value</li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;number&gt;</code>: the number of rows affected</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  body<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">:</span> body <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Sorry, updating 'priority' isn't allowed`</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  priority<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">:</span> priority <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Sorry, updating 'body' isn't allowed`</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'code'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'create the best thing'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'docs'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'crap what did I create'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  todos<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'tests'</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token string">'totally works'</span><span class="token punctuation">,</span> priority<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token function">setRaw</span><span class="token punctuation">(</span><span class="token string">'priority'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'docs'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 1</span>

<span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token function">setRaw</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'priority'</span><span class="token punctuation">,</span> <span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'not important ;)'</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 2</span>

<span class="token comment">// using the non-raw method fires the setters</span>
<span class="token comment">// this causes the errors above to be thrown</span>

<span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'priority'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'docs'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; Error: `Sorry, updating 'priority' isn't allowed`</span>

<span class="token keyword">await</span> todos<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'priority'</span><span class="token punctuation">,</span> <span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'not important ;)'</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; Error: `Sorry, updating 'body' isn't allowed`</span>
</code></pre></div></div> <h3 id="increment"><a href="#increment" aria-hidden="true" class="header-anchor">#</a> increment</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">increment</span> <span class="token punctuation">(</span>
  column<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> criteria<span class="token operator">?</span><span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> amount<span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span>
</code></pre></div><p>Increment a value at <code>column</code> by a specified <code>amount</code>, which defaults
to <code>1</code> if not provided.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} column</code>: the target value</li> <li><em>optional</em> <code>{number} amount</code> <ul><li><em>default</em> = <code>1</code></li></ul></li> <li><em>optional</em> <code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;number&gt;</code>: the number of rows affected</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// the amount defaults to 1, so these are equivalent</span>
people<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Bob'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
people<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Bob'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// happy birthday, Bob!</span>
</code></pre></div></div> <h3 id="decrement"><a href="#decrement" aria-hidden="true" class="header-anchor">#</a> decrement</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">decrement</span> <span class="token punctuation">(</span>
  column<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  criteria<span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  amount<span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  allowNegative<span class="token punctuation">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span>
</code></pre></div><p>Decrement a value at <code>column</code> by a specified <code>amount</code>, which defaults to <code>1</code>
if not provided. To allow the target value to dip below <code>0</code>, pass <code>true</code> as
the final argument.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} column</code>: the target value</li> <li><em>optional</em> <code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li> <li><em>optional</em> <code>{number} amount</code> <ul><li><em>default</em> = <code>1</code></li></ul></li> <li><em>optional</em> <code>{boolean} allowNegative</code>: unless set to <code>true</code>, the value will not be allowed to go below a value of <code>0</code> <ul><li><em>default</em> = <code>false</code></li></ul></li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;number&gt;</code>: the number of rows affected</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// the amount defaults to 1, so these are equivalent</span>
people<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Benjamin Button'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
people<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Benjamin Button'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// to allow negative values as a result of this query:</span>
people<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Benjamin Button'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
people<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Benjamin Button'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="remove"><a href="#remove" aria-hidden="true" class="header-anchor">#</a> remove</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">remove</span> <span class="token punctuation">(</span>criteria<span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span>
</code></pre></div><p>Delete a row from the table matching <code>criteria</code>. If <code>criteria</code> is empty or
absent, nothing will be done. This is a safeguard against unintentionally
deleting everything in the table. Use <a href="#clear"><code>clear()</code></a> if you want
to remove all rows.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;number&gt;</code>: the number of rows affected</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code>users<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> expired<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="clear"><a href="#clear" aria-hidden="true" class="header-anchor">#</a> clear</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">clear</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span>
</code></pre></div><p>Removes all rows from the table.</p> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;number&gt;</code>: the number of rows affected</p></div> <h3 id="count"><a href="#count" aria-hidden="true" class="header-anchor">#</a> count</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">count</span> <span class="token punctuation">(</span>criteria<span class="token operator">?</span><span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">:</span> AggregateOptions<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span>
</code></pre></div><p>Count the number of rows in the table.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><em>optional</em> <code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li> <li><em>optional</em> <code>{AggregateOptions} options</code>:</li></ul> <table><thead><tr><th>property</th> <th style="text-align:center;">type</th> <th style="text-align:center;">default</th> <th>description</th></tr></thead> <tbody><tr><td><code>distinct</code></td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;"><code>false</code></td> <td>Counts only unique values if <code>true</code>.</td></tr> <tr><td><code>group</code></td> <td style="text-align:center;"><code>string</code>, <code>string[]</code></td> <td style="text-align:center;">-</td> <td>Add a group clause to the query.</td></tr></tbody></table></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;number&gt;</code>: the number of rows found, matching <code>criteria</code> if specified</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <p>Assuming we have this data in our <code>people</code> table:</p> <table><thead><tr><th style="text-align:center;">name</th> <th style="text-align:center;">age</th></tr></thead> <tbody><tr><td style="text-align:center;">Bob</td> <td style="text-align:center;">18</td></tr> <tr><td style="text-align:center;">Dale</td> <td style="text-align:center;">25</td></tr> <tr><td style="text-align:center;">Harry</td> <td style="text-align:center;">32</td></tr></tbody></table> <div class="language-ts extra-class"><pre class="language-ts"><code>people<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 3</span>

people<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 2</span>

people<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 1</span>
</code></pre></div><p>Now assume we've defined models <code>people</code>, <code>places</code>, <code>things</code>, &amp; <code>ideas</code>.
If we use <code>count()</code> with no arguments on the trilogy instance we can count
the number of tables in the database:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>db<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 4</span>
</code></pre></div></div> <h3 id="countin"><a href="#countin" aria-hidden="true" class="header-anchor">#</a> countIn</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">countIn</span> <span class="token punctuation">(</span>
  column<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> criteria<span class="token operator">?</span><span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">:</span> AggregateOptions
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span>
</code></pre></div><p>Count the number of rows in the table, selecting on <code>column</code> (meaning <code>NULL</code>
values are not counted).</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} column</code>: column to select on</li> <li><em>optional</em> <code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li> <li><em>optional</em> <code>{AggregateOptions} options</code>: same as <a href="#count"><code>count()</code></a></li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;number&gt;</code>: the number of rows found, matching <code>criteria</code> if specified</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <p>Assuming we have this data in our <code>people</code> table:</p> <table><thead><tr><th style="text-align:center;">name</th> <th style="text-align:center;">age</th></tr></thead> <tbody><tr><td style="text-align:center;">Bob</td> <td style="text-align:center;">18</td></tr> <tr><td style="text-align:center;">Dale</td> <td style="text-align:center;">25</td></tr> <tr><td style="text-align:center;">Harry</td> <td style="text-align:center;">32</td></tr></tbody></table> <div class="language-ts extra-class"><pre class="language-ts"><code>people<span class="token punctuation">.</span><span class="token function">countIn</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 3</span>
</code></pre></div></div> <h3 id="min"><a href="#min" aria-hidden="true" class="header-anchor">#</a> min</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">min</span> <span class="token punctuation">(</span>
  column<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> criteria<span class="token operator">?</span><span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">:</span> AggregateOptions
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span>
</code></pre></div><p>Find the minimum value contained in the model, comparing all values
in <code>column</code> that match <code>criteria</code>.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} column</code>: column to compare</li> <li><em>optional</em> <code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li> <li><em>optional</em> <code>{AggregateOptions} options</code>:</li></ul> <table><thead><tr><th>property</th> <th style="text-align:center;">type</th> <th style="text-align:center;">default</th> <th>description</th></tr></thead> <tbody><tr><td><code>group</code></td> <td style="text-align:center;"><code>string</code>, <code>string[]</code></td> <td style="text-align:center;">-</td> <td>Add a group clause to the query.</td></tr></tbody></table></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;number&gt;</code>: the minimum number found by the query</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <p>Given this data in the <code>people</code> model:</p> <table><thead><tr><th style="text-align:center;">name</th> <th style="text-align:center;">age</th></tr></thead> <tbody><tr><td style="text-align:center;">Bob</td> <td style="text-align:center;">18</td></tr> <tr><td style="text-align:center;">Dale</td> <td style="text-align:center;">25</td></tr> <tr><td style="text-align:center;">Harry</td> <td style="text-align:center;">32</td></tr></tbody></table> <div class="language-ts extra-class"><pre class="language-ts"><code>people<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 18</span>
</code></pre></div></div> <h3 id="max"><a href="#max" aria-hidden="true" class="header-anchor">#</a> max</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">max</span> <span class="token punctuation">(</span>
  column<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> criteria<span class="token operator">?</span><span class="token punctuation">:</span> Criteria<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">:</span> AggregateOptions
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span>
</code></pre></div><p>Find the maximum value contained in the model, comparing all values
in <code>column</code> that match <code>criteria</code>.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{string} column</code>: column to compare</li> <li><em>optional</em> <code>{Criteria&lt;D&gt;} criteria</code>: criteria used to restrict selection
<ul><li>Object syntax means 'where (key) is equal to (value)'</li> <li>Array syntax is one of:
<ul><li>a length of 2, ie. a key / value pair (equal to)</li> <li>a length of 3, ie. <code>['age', '&lt;', 65]</code> (allows other comparisons)</li> <li>a list containing any number of the above forms</li></ul></li></ul></li> <li><em>optional</em> <code>{AggregateOptions} options</code>:</li></ul> <table><thead><tr><th>property</th> <th style="text-align:center;">type</th> <th style="text-align:center;">default</th> <th>description</th></tr></thead> <tbody><tr><td><code>group</code></td> <td style="text-align:center;"><code>string</code>, <code>string[]</code></td> <td style="text-align:center;">-</td> <td>Add a group clause to the query.</td></tr></tbody></table></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>Promise&lt;number&gt;</code>: the maximum number found by the query</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <p>Given this data in the <code>people</code> model:</p> <table><thead><tr><th style="text-align:center;">name</th> <th style="text-align:center;">age</th></tr></thead> <tbody><tr><td style="text-align:center;">Bob</td> <td style="text-align:center;">18</td></tr> <tr><td style="text-align:center;">Dale</td> <td style="text-align:center;">25</td></tr> <tr><td style="text-align:center;">Harry</td> <td style="text-align:center;">32</td></tr></tbody></table> <div class="language-ts extra-class"><pre class="language-ts"><code>people<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 32</span>
</code></pre></div></div> <h2 id="hooks"><a href="#hooks" aria-hidden="true" class="header-anchor">#</a> Hooks</h2> <p>Every <code>Model</code> instance inherits this set of lifecycle hooks. In addition
hooks can be managed at the database level, in which case the signature
changes to also accept an optional model name to attach the subsciber to.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// subscribe to the `beforeCreate` hook on 'users':</span>
users<span class="token punctuation">.</span><span class="token function">beforeCreate</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">,</span> user <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// subscribe to the `beforeCreate` hook on all models:</span>
db<span class="token punctuation">.</span><span class="token function">beforeCreate</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="onquery-hook"><a href="#onquery-hook" aria-hidden="true" class="header-anchor">#</a> onQuery Hook</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">onQuery</span> <span class="token punctuation">(</span>fn<span class="token punctuation">:</span> OnQueryCallback<span class="token punctuation">,</span> options<span class="token punctuation">:</span> OnQueryOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span>
</code></pre></div><p>The <code>onQuery</code> hook is called each time a query is run on the database, and
receives the query in string form. This is useful for logging and debugging
features.</p> <p>By default, subscribers to this hook do not receive any of the various internal
queries that trilogy executes behind the scenes. If you want these queries
to be passed as well, set the <code>includeInternal</code> property to <code>true</code> in the
options parameter of <code>onQuery</code>:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>people<span class="token punctuation">.</span><span class="token function">onQuery</span><span class="token punctuation">(</span>query <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// query is now potentially one of the internal queries</span>
  <span class="token comment">// trilogy runs behind the scenes for managing models</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> includeInternal<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{OnQueryCallback} fn</code>: the function to call when queries are executed</li> <li><em>optional</em> <code>{OnQueryOptions} options</code>:</li></ul> <table><thead><tr><th>property</th> <th style="text-align:center;">type</th> <th style="text-align:center;">default</th> <th>description</th></tr></thead> <tbody><tr><td><code>includeInternal</code></td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;">false</td> <td>Include internal trilogy queries.</td></tr></tbody></table></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>() =&gt; boolean</code>: unsubscribe function that removes this callback</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> unsub <span class="token operator">=</span> people<span class="token punctuation">.</span><span class="token function">onQuery</span><span class="token punctuation">(</span>query <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">/* ...queries logged in the meantime... */</span>

<span class="token function">unsub</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// no more queries will be logged</span>
</code></pre></div></div> <h3 id="beforecreate-hook"><a href="#beforecreate-hook" aria-hidden="true" class="header-anchor">#</a> beforeCreate Hook</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">beforeCreate</span><span class="token punctuation">(</span>fn<span class="token punctuation">:</span> BeforeCreateCallback<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span>
</code></pre></div><p>Before an object is created, the <code>beforeCreate</code> hook is called with the
object. This occurs <em>before</em> casting, so if a subscriber to this hook
modifies the incoming object those changes will be subject to casting.
It's also possible to prevent the object from being created entirely
by returning the <code>EventCancellation</code> symbol from a subscriber callback.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{BeforeCreateCallback} fn</code>: callback executed when the hook is triggered</li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>() =&gt; boolean</code>: unsubscribe function that removes this callback</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> unsub <span class="token operator">=</span> people<span class="token punctuation">.</span><span class="token function">beforeCreate</span><span class="token punctuation">(</span>person <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">doesNotMeetCondition</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// prevent this object from being created</span>
    <span class="token keyword">return</span> EventCancellation
  <span class="token punctuation">}</span>


  person<span class="token punctuation">.</span>creation_date <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">unsub</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="aftercreate-hook"><a href="#aftercreate-hook" aria-hidden="true" class="header-anchor">#</a> afterCreate Hook</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">afterCreate</span><span class="token punctuation">(</span>fn<span class="token punctuation">:</span> AfterCreateCallback<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span>
</code></pre></div><p>When an object is created, that object is returned to you and the
<code>afterCreate</code> hook is called with it.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{AfterCreateCallback} fn</code>: callback executed when the hook is triggered</li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>() =&gt; boolean</code>: unsubscribe function that removes this callback</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> unsub <span class="token operator">=</span> people<span class="token punctuation">.</span><span class="token function">afterCreate</span><span class="token punctuation">(</span>person <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// log the object that was created</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// stop logging</span>
<span class="token function">unsub</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="beforeupdate-hook"><a href="#beforeupdate-hook" aria-hidden="true" class="header-anchor">#</a> beforeUpdate Hook</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">beforeUpdate</span><span class="token punctuation">(</span>fn<span class="token punctuation">:</span> BeforeUpdateCallback<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span>
</code></pre></div><p>Prior to an object being updated the <code>beforeUpdate</code> hook is called with the
update <em>delta</em>, or the incoming changes to be made, as well as the criteria.
Casting occurs after this hook. A subscriber could choose to cancel the update
by returning the <code>EventCancellation</code> symbol or alter the selection criteria.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{BeforeUpdateCallback} fn</code>: callback executed when the hook is triggered</li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>() =&gt; boolean</code>: unsubscribe function that removes this callback</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> unsub <span class="token operator">=</span> people<span class="token punctuation">.</span><span class="token function">beforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>changes<span class="token punctuation">,</span> criteria<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>criteria<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// make an ID mandatory to update records</span>
    <span class="token keyword">return</span> EventCancellation
  <span class="token punctuation">}</span>

  <span class="token comment">// add a manual timestamp to updated records</span>
  changes<span class="token punctuation">.</span>updated_on <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">unsub</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="afterupdate-hook"><a href="#afterupdate-hook" aria-hidden="true" class="header-anchor">#</a> afterUpdate Hook</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">afterUpdate</span><span class="token punctuation">(</span>fn<span class="token punctuation">:</span> AfterUpdateCallback<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span>
</code></pre></div><p>Subscribers to the <code>afterUpdate</code> hook receive modified objects after they
are updated.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{AfterUpdateCallback} fn</code>: callback executed when the hook is triggered</li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>() =&gt; boolean</code>: unsubscribe function that removes this callback</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> unsub <span class="token operator">=</span> people<span class="token punctuation">.</span><span class="token function">afterUpdate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>updatedPeople<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  updatedPeople<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>person <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>updated_on<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">unsub</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="beforeremove-hook"><a href="#beforeremove-hook" aria-hidden="true" class="header-anchor">#</a> beforeRemove Hook</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">beforeRemove</span><span class="token punctuation">(</span>fn<span class="token punctuation">:</span> BeforeRemoveCallback<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span>
</code></pre></div><p>Before object removal, the criteria for selecting those objects is passed to
the <code>beforeRemove</code> hook. Casting occurs after this hook. Subscribers can modify
the selection criteria or prevent the removal entirely by returning the
<code>EventCancellation</code> symbol.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{BeforeRemoveCallback} fn</code>: callback executed when the hook is triggered</li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>() =&gt; boolean</code>: unsubscribe function that removes this callback</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> unsub <span class="token operator">=</span> people<span class="token punctuation">.</span><span class="token function">beforeRemove</span><span class="token punctuation">(</span>criteria <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>criteria<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// make an ID mandatory to remove records</span>
    <span class="token keyword">return</span> EventCancellation
  <span class="token punctuation">}</span>

  <span class="token comment">// object will be removed</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">unsub</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="afterremove-hook"><a href="#afterremove-hook" aria-hidden="true" class="header-anchor">#</a> afterRemove Hook</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">afterRemove</span><span class="token punctuation">(</span>fn<span class="token punctuation">:</span> AfterRemoveCallback<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span>
</code></pre></div><p>A list of any removed objects is passed to the <code>afterRemove</code> hook.</p> <div class="arguments custom-block"><p class="custom-block-title">ARGUMENTS</p> <ul><li><code>{AfterRemoveCallback} fn</code>: callback executed when the hook is triggered</li></ul></div> <div class="returns custom-block"><p class="custom-block-title">RETURNS</p> <p><code>() =&gt; boolean</code>: unsubscribe function that removes this callback</p></div> <div class="usage custom-block"><p class="custom-block-title">USAGE</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> unsub <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">afterRemove</span><span class="token punctuation">(</span>users <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Removed </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> from the database.`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">unsub</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/citycide/trilogy/edit/master/reference/api.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last updated: </span> <span class="time">6/12/2019, 9:32:30 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.f52a1c03.js" defer></script><script src="/assets/js/2.201cfc91.js" defer></script><script src="/assets/js/11.e5a74d17.js" defer></script>
  </body>
</html>
